<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAM.gov Matcher - Opportunity Finder</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1>üéØ SAM.gov Opportunity Matcher</h1>
                    <p class="subtitle">Find and track government contract opportunities</p>
                </div>
                <div class="header-buttons">
                    <button type="button" class="btn-daily-alert" id="dailyAlertBtn" title="Enable daily email alerts">
                        üîî Daily Alert: OFF
                    </button>
                    <button type="button" class="btn-new-search" id="newSearchBtn">
                        üîç New Search
                    </button>
                </div>
            </div>
        </header>

        <main>
            <!-- Status Display -->
            <div id="statusDisplay" class="status-display hidden">
                <div class="status-icon" id="statusIcon">‚è≥</div>
                <div class="status-text" id="statusText">Waiting...</div>
            </div>

            <!-- Previous Searches Section -->
            <div class="searches-section">
                <div class="form-group">
                    <label for="searchHistory">Previous Searches:</label>
                    <div class="search-history-row">
                        <select id="searchHistory" class="search-dropdown">
                            <option value="">-- Select a previous search --</option>
                        </select>
                        <button type="button" class="btn-primary" id="loadSearchBtn">
                            üì• Load
                        </button>
                        <button type="button" class="btn-delete-search" id="deleteSearchBtn" title="Delete selected search">
                            üóëÔ∏è
                        </button>
                    </div>
                    <small>Select from your last 10 searches to reload results</small>
                </div>
            </div>

            <!-- API Call Counter -->
            <div class="api-counter-row">
                <div class="api-counter" id="apiCounter">
                    <span class="api-counter-label">Daily Searches Remaining:</span>
                    <span class="api-counter-value" id="apiCounterValue">10/10</span>
                </div>
            </div>

            <!-- Opportunities Display -->
            <div id="opportunitiesSection" class="opportunities-section">
                <h2>üìã Your Opportunities</h2>
                <div id="opportunitiesContent">
                    <p class="empty-state">Select a previous search from the dropdown or click "New Search" to find opportunities.</p>
                </div>
            </div>

        </main>

        <footer>
            <p>SAM.gov Matcher v2.0 | Powered by Make.com & Google Maps API</p>
            <button type="button" class="btn-help" id="showHelpBtn">‚ùì How to Use</button>
        </footer>
    </div>

    <!-- Search Modal -->
    <div id="searchModal" class="modal hidden">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîç Search Opportunities</h2>
                <button type="button" class="modal-close" id="modalCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="searchForm" class="search-form">

                    <!-- User Identification -->
                    <div class="form-section">
                        <h2>üë§ Your Information</h2>
                        <div class="form-group">
                            <label for="userEmail">Your Email: <span class="required">*</span></label>
                            <input
                                type="email"
                                id="userEmail"
                                name="user_email"
                                placeholder="your.email@company.com"
                                required
                            >
                            <small>Used to save and retrieve your search settings</small>
                        </div>
                        <div class="form-group">
                            <label for="userName">Your Name:</label>
                            <input
                                type="text"
                                id="userName"
                                name="user_name"
                                placeholder="John Smith"
                            >
                            <small>Optional: For display purposes</small>
                        </div>
                    </div>

                    <!-- Company Information -->
                    <div class="form-section">
                        <h2>üè¢ Your Company Information</h2>

                        <!-- ZIP Code -->
                        <div class="form-group">
                            <label for="companyZip">Your ZIP Code: <span class="required">*</span></label>
                            <input
                                type="text"
                                id="companyZip"
                                name="company_zip"
                                placeholder="92019"
                                pattern="[0-9]{5}"
                                maxlength="5"
                                required
                            >
                            <small>5-digit ZIP code where your company is located</small>
                        </div>

                        <!-- Business Type (Set-Asides) -->
                        <div class="form-group">
                            <label>Business Type / Set-Aside Qualifications:</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="set_aside" value="NONE" checked>
                                    <span>Open Competition (no restriction)</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="set_aside" value="SBA" checked>
                                    <span>SBA - Small Business Set-Aside</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="set_aside" value="SDVOSBC">
                                    <span>SDVOSBC - Service-Disabled Veteran-Owned</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="set_aside" value="8A">
                                    <span>8(a) - 8(a) Business Development</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="set_aside" value="WOSB">
                                    <span>WOSB - Women-Owned Small Business</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="set_aside" value="HUBZone">
                                    <span>HUBZone - Historically Underutilized Business Zone</span>
                                </label>
                            </div>
                            <small>Select which set-aside types your company qualifies for</small>
                        </div>

                        <!-- NAICS Codes -->
                        <div class="form-group">
                            <label for="naicsCodes">NAICS Codes (comma-separated): <span class="required">*</span></label>
                            <input
                                type="text"
                                id="naicsCodes"
                                name="naics_filter"
                                placeholder="238220, 236220, 238210"
                                value="238220"
                                required
                            >
                            <small>Industry codes your company bids on (e.g., 238220 for HVAC)</small>
                        </div>

                        <!-- PSC Codes -->
                        <div class="form-group">
                            <label for="pscCodes">PSC Codes (comma-separated):</label>
                            <input
                                type="text"
                                id="pscCodes"
                                name="psc_filter"
                                placeholder="J041, J045, Y1JZ"
                            >
                            <small>Optional: Product/Service codes (leave blank to skip PSC filtering)</small>
                        </div>
                    </div>

                    <!-- Preferences -->
                    <div class="form-section">
                        <h2>üéØ Search Preferences</h2>

                        <!-- Max Distance Slider -->
                        <div class="form-group">
                            <label for="maxDistance">
                                Maximum Travel Distance:
                                <strong><span id="maxDistanceValue">200</span> miles</strong>
                            </label>
                            <input
                                type="range"
                                id="maxDistance"
                                name="max_distance"
                                min="50"
                                max="1000"
                                value="200"
                                step="50"
                                class="slider"
                            >
                            <div class="slider-labels">
                                <span>50 mi</span>
                                <span>500 mi</span>
                                <span>1,000 mi</span>
                            </div>
                            <small>How far are you willing to travel for projects?</small>
                        </div>

                        <!-- Minimum Contract Value -->
                        <div class="form-group">
                            <label for="minValue">
                                Minimum Contract Value:
                                <strong>$<span id="minValueDisplay">50,000</span></strong>
                            </label>
                            <input
                                type="range"
                                id="minValue"
                                name="min_value"
                                min="0"
                                max="500000"
                                value="50000"
                                step="10000"
                                class="slider"
                            >
                            <div class="slider-labels">
                                <span>$0</span>
                                <span>$250k</span>
                                <span>$500k</span>
                            </div>
                            <small>Minimum project size you're interested in (set to $0 for any size)</small>
                        </div>

                        <!-- Bid Comfort Days -->
                        <div class="form-group">
                            <label for="bidComfortDays">
                                Bid Preparation Time:
                                <strong><span id="bidComfortDaysValue">14</span> days</strong>
                            </label>
                            <input
                                type="range"
                                id="bidComfortDays"
                                name="bid_comfort_days"
                                min="3"
                                max="60"
                                value="14"
                                step="1"
                                class="slider"
                            >
                            <div class="slider-labels">
                                <span>3 days</span>
                                <span>30 days</span>
                                <span>60 days</span>
                            </div>
                            <small>How many days you need to prepare a competitive bid</small>
                        </div>

                        <!-- Minimum Days Until Deadline -->
                        <div class="form-group">
                            <label for="minDays">
                                Minimum Days Until Deadline:
                                <strong><span id="minDaysValue">7</span> days</strong>
                            </label>
                            <input
                                type="range"
                                id="minDays"
                                name="min_days"
                                min="0"
                                max="30"
                                value="7"
                                step="1"
                                class="slider"
                            >
                            <div class="slider-labels">
                                <span>0 days</span>
                                <span>15 days</span>
                                <span>30 days</span>
                            </div>
                            <small>Filter out opportunities closing too soon</small>
                        </div>
                    </div>

                    <!-- Score Importance Ranking -->
                    <div class="form-section">
                        <h2>‚öñÔ∏è Rank What Matters Most</h2>
                        <p style="color: #6c757d; font-size: 14px; margin-bottom: 20px;">
                            Drag and drop to rank these factors by importance. #1 = Most Important, #5 = Least Important
                        </p>

                        <div id="rankingContainer" class="ranking-container">
                            <!-- Ranking items will be populated by JavaScript -->
                        </div>

                        <div class="ranking-legend">
                            <p style="font-size: 13px; color: #6c757d; margin-top: 15px;">
                                üí° <strong>Tip:</strong> Rank #1 will have ~4x more influence on match scores than Rank #5
                            </p>
                        </div>

                        <!-- Hidden inputs to store ranking -->
                        <input type="hidden" id="locationRank" name="location_rank" value="3">
                        <input type="hidden" id="valueRank" name="value_rank" value="1">
                        <input type="hidden" id="feasibilityRank" name="feasibility_rank" value="2">
                        <input type="hidden" id="effortRank" name="effort_rank" value="5">
                        <input type="hidden" id="specialRank" name="special_rank" value="4">
                    </div>

                    <!-- Additional Options -->
                    <div class="form-section">
                        <h2>üîß Additional Options</h2>

                        <!-- Include Awarded Toggle -->
                        <div class="form-group">
                            <label class="toggle-label">
                                <input type="checkbox" name="include_awarded" id="includeAwarded">
                                <span class="toggle-switch"></span>
                                <span>Include already-awarded contracts (for research)</span>
                            </label>
                            <small>Awarded contracts are useful for competitive intelligence</small>
                        </div>


                        <!-- Special Requests / Custom Rules -->
                        <div class="form-group">
                            <label for="specialRequest">Special Requests / Custom Search Rules:</label>
                            <textarea
                                id="specialRequest"
                                name="special_request"
                                rows="4"
                                placeholder="Example: 'Prefer opportunities from Department of Defense or Veterans Affairs. Avoid projects requiring security clearance. Prioritize HVAC retrofits over new construction.'"
                            ></textarea>
                            <small>Optional: Add custom criteria in plain English. AI will apply these rules to your search.</small>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-actions">
                        <button type="submit" class="btn-primary" id="submitBtn">
                            üöÄ Search Opportunities
                        </button>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <!-- Daily Alert Modal -->
    <div id="dailyAlertModal" class="modal hidden">
        <div class="modal-overlay" id="dailyAlertOverlay"></div>
        <div class="modal-content daily-alert-modal">
            <div class="modal-header">
                <h2>üîî Daily Alert Settings</h2>
                <button type="button" class="modal-close" id="dailyAlertCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p class="alert-description">
                    Get an email notification when new opportunities match your search criteria.
                    Uses <strong>1 search credit per day</strong> when enabled.
                </p>

                <div class="form-group">
                    <label for="alertEmail">Email for Notifications: <span class="required">*</span></label>
                    <input
                        type="email"
                        id="alertEmail"
                        placeholder="your.email@company.com"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="alertSearchTemplate">Use Search Settings From:</label>
                    <select id="alertSearchTemplate" class="search-dropdown">
                        <option value="">-- Select a previous search --</option>
                    </select>
                    <small>Select which search criteria to use for daily alerts</small>
                </div>

                <div class="alert-status" id="alertStatus">
                    <span class="status-indicator off"></span>
                    <span class="status-text">Daily alerts are currently <strong>OFF</strong></span>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-enable-alert" id="toggleAlertBtn">
                        üîî Enable Daily Alerts
                    </button>
                </div>

                <div class="alert-info">
                    <p>üìß You'll receive an email only when <strong>new</strong> opportunities are found that you haven't seen before.</p>
                    <p>‚è∞ Searches run automatically once per day.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Welcome/Directions Modal -->
    <div class="welcome-overlay" id="welcomeOverlay"></div>
    <div id="welcomeModal" class="welcome-modal">
        <div class="welcome-content">
            <div class="welcome-header">
                <h2>üëã Welcome to SAM.gov Matcher!</h2>
            </div>
            <div class="welcome-body">
                <p class="welcome-intro">Find government contract opportunities tailored to your business.</p>

                <div class="welcome-steps">
                    <div class="welcome-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>üîç New Search</h4>
                            <p>Click "New Search" to set your criteria: ZIP code, NAICS codes, distance, contract value, and more.</p>
                        </div>
                    </div>

                    <div class="welcome-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>üìä View Results</h4>
                            <p>Browse opportunities matched to your preferences. Each card shows key details like deadline, agency, and set-aside type.</p>
                        </div>
                    </div>

                    <div class="welcome-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>üéØ Smart Filtering</h4>
                            <p>Your preferences are automatically applied to filter opportunities by NAICS codes, set-asides, deadline, and contract value.</p>
                        </div>
                    </div>

                    <div class="welcome-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>üì• Previous Searches</h4>
                            <p>Your last 10 searches are saved automatically. Use the dropdown to reload any previous search results.</p>
                        </div>
                    </div>
                </div>

                <div class="welcome-note">
                    <strong>‚ö†Ô∏è Daily Limit:</strong> You have <strong>10 searches per day</strong> (resets every 24 hours).<br>
                    <strong>üí° Tip:</strong> Enable <strong>Daily Alerts</strong> to get email notifications for new opportunities!
                </div>

                <div class="welcome-actions">
                    <button type="button" class="btn-get-started" id="welcomeCloseBtn">
                        üöÄ Get Started
                    </button>
                </div>

                <label class="welcome-checkbox">
                    <input type="checkbox" id="dontShowAgain">
                    <span>Don't show this again</span>
                </label>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
